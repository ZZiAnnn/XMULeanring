**4.2 选择题**
1-5 AADDC 6-10 BDBBA 
11-15 ACCCD 16-19 BDAD

**4.6	用32K×8位RAM芯片和64K×4位ROM芯片设计256K×8位存储器。其中，从30000H到3FFFFH的地址空间为只读存储区，其他为可读、可写存储区。完成存储器与CPU的连接。**

![DA1C7A014C3D0445A0B82E1B81D818D0](C:\Users\26401\Documents\Tencent Files\2640115971\FileRecv\MobileFile\DA1C7A014C3D0445A0B82E1B81D818D0.png)

**4.8	用64K×1位的DRAM芯片构成1M×8位的存储器，若采用异步刷新，每行刷新间隔不超过2ms，则产生刷新信号的间隔时间是多少?假设读写周期为0.5us，若采用集中刷新方式，则存储器刷新一遍最少要用多少个读写周期?CPU的“死”时间为多少?**

64K的DRAM总共有256行256列，所以刷新间隔为$2ms/256=7.8125 \mu s$,读写周期等于刷新一行所用的时间，所以才用集中刷新一遍需要256个读写操作，CPU的死时间为$0.5\mu s \times 256=128 \mu s$

**4.11	设cache 的容量为2块，每块是一个32位字，主存容量是cache容量的256倍，其中有表4.13所示的数据（地址和数据均采用十六进制表示)**

| **地址**   | **数据**     | **地址**   | **数据**     |
| ---------- | ------------ | ---------- | ------------ |
| **000000** | **87568536** | **01FFFC** | **4FFFFC68** |
| **000008** | **87992301** | **FFFFF8** | **01BF2460** |
| **010004** | **9ABEFCD0** |            |              |

**将这些数据装入cache后，cache个快中的数据内容及相应的标志是什么？**

**（1）全相联映射 （2）直接相联映射 （3）四路组相联映射**

cache共有$2^{14}$块，每块是32位字，因此主存为4GB，根据所给地址为24位十六进制可知是按照字节编址，所以在主存地址中偏移占2位

(1)全相联映射：偏移占2位，剩下的前面22位都为标志

| 行号  | tag    | 数据内容  |
| ----- | ------ | --------- |
| 0000H | 000000 | 87568536  |
| 0001H | 000002 | 87792301  |
| 0002H | 004001 | 9ABEFCD0  |
| 0003H | 007FFF | 4FFFFFC68 |
| 0004H | 3FFFFE | 01BF2460  |

(2)直接相联映射：偏移占2位，总共有$2^{14}$个cache块，因此一共有14位用于行索引，剩下前面8位用于作为标志

| 行号  | tag  | 数据内容  |
| ----- | ---- | --------- |
| 0000H | 00   | 87568536  |
| 0002H | 00   | 87792301  |
| 0001H | 01   | 9ABEFCD0  |
| 3FFFH | 01   | 4FFFFFC68 |
| 3FFEH | FF   | 01BF2460  |

(3)四路组相联映射：偏移占2位，总共有$2^{12}$个cache组，因此一共有12位用于组索引，剩下前面10位用于作为标志

| 组号  | tag  | 数据内容  |
| ----- | ---- | --------- |
| 0000H | 000  | 87568536  |
| 0002H | 000  | 87792301  |
| 0001H | 004  | 9ABEFCD0  |
| 0FFFH | 007  | 4FFFFFC68 |
| 0FFEH | 3FF  | 01BF2460  |

**4.14假定某数组元素按行优先顺序存放在主存中，则在以下两段伪代码A和B中，分析下列问题。**
**(1)两段代码中对数组访问的时间局部性和空间局部性。**
**(2)变量sum的时间局部性和空间局部性。**
**(3) for循环体对指令访问的时间局部性和空间局部性。**

```c++ 
int sum_array_A(int a[M][N])
{
    int i,j,sum=0;
	for (i=0 ;i<M;i++)
    {
        for(j=0;j<N;j++)
        {
            sum+=a[i][j];
        }
    }
	return sum;
} 
```

```c++
int sum_array_B(int a[M][N])
{
    int i,j,sum=0;
	for (i=0 ;i<N;i++)
    {
        for(j=0;j<M;j++)
        {
            sum+=a[j][i];
        }
    }
	return sum;
} 
```

（1）代码A对数组的访问有良好的空间局部性，没有时间局部性；代码B的空间局部性一般，没有时间局部性

（2）两段代码中sum都会被多次使用，因此具有良好的时间局部性

（3）两个for循环对指令访问都具有时间局部性，除此之外指令序列在主存中顺序存放，具有空间局部性

**4.17某计算机系统中有一个`TLB`和`L1`级数据`cache`，存储系统按字节编址，虚拟存储容量为2GB,主存容量为4MB，页大小为128KB，TLB采用四路组相联方式，共有 16个页表项。cache容量为16KB，每块包含8个字，每字为32位，映射方式采用四路组相联，回答下列问题。**
**(1)虚拟地址中哪几位表示虚拟页号?哪几位表示页内地址?虚拟页号中哪几位表示TLB标记?哪几位表示TLB索引?**
**(2)物理地址中哪几位表示物理页号?哪几位表示偏移地址?**
**(3)为实现主存与数据cache之间的组相联映射，对该地址应进行怎样的划分?**

(1)虚拟存储容量为2GB，因此虚拟地址总共为31位。页面大小为128KB，因此页内偏移为17位，所以可知虚拟地址中的高14位表示虚拟页号，低17位表示页内地址
TLB有16个页表项，采用四路组相联映射，此时有4个分组，因此TLBI占2位，所以虚拟页号的高12位为TLB标记，低2位为TLBI索引

（2）主存为4MB，因此主存地址总共有22位，页内偏移地址位数和虚拟地址中的相同，因此物理地址的高5位物理页号，低17位为页内偏移地址

（3）主存地址一共为22位，cache容量为16KB，每块包含8个字，每字为32位，因此一个cache块大小为32个字节，所以总共有512个cache块，采用四路组相联划分为128K个组，所以组索引需要7位，一个块内有32个字节，所以偏移地址占4位，剩下的10位标记
因此主存地址格式为：标记（10位）+组索引（7位）+块内偏移地址（5位）

**4.19某计算机采用页式虚拟存储管理方式，按字节编址。`CPU`进行存储访问的过程如图`4.58`所示。回答下列问题。**
**(1)主存的物理地址占多少位?**
**(2)`TLB`采用什么映射方式?`TLB`是用`SRAM`还是用`DRAM`实现?**
**(3) `cache`采用什么映射方式?若`cache`采用`LRU`替换算法和写回策略，则`cache`每行中除数据`(Data)、 tag`和有效位外，还应有哪些附加位? `cache`总容量是多少? `cache`中有效位的作用是什么?**
**(4)若`CPU`给出的虚拟地址为`0008 C040H`，则对应的物理地址是多少?是否在`cache`中命中?说明理由，若`CPU`给出的虚拟地址为`0007C260H`，则该地址所在主存块映射到的`cache`组号是多少?**

<img src="C:\Users\26401\AppData\Roaming\Typora\typora-user-images\image-20230506162701113.png" alt="image-20230506162701113" style="zoom: 67%;" />

(1) 根据cache可知主存的物理地址占28位

(2) TLB采用全相联映射，SRAM

(3)二路组相联映射，脏数据位和LRU淘汰计数器，cache组索引一共有3位，所以一共有8组，每组有2路，所以总共有16个cache块，主存地址中的cache数据块内偏移占5位，所以一个数据块为32个字节，所以cache数据容量$512$B,cache块中标记占3位，除此之外还有20位的标记，所以cache总容量=$512+3\times16/8+20\times16/8$=558B
有效位可以标志cache块中的信息是否有效

(4)0008C在TLB中命中，直接得到物理页号为0040H，所以对应的物理地址为0040040H,tag为00400H，对应的cache有效位为0，所以没有命中；0007C在TLB没命中，但是不影响寻找cache的组号，页内偏移地址为低12位，即260H，所以对应的物理地址的低12位为260H，cache的第5-8位为cache的组号，所以cache组号为3

