# 第5章 指令系统

**5.2选择题**

1-5 AAACC 6-10 ADDDB 11-12 CAA

**5.4根据操作数所在的位置，在空格处填写其寻址方式**
**(1)操作数在指令中为<u>立即数</u>寻址方式**
**(2)操作数在地址(主存)在指令中为<u>直接</u>寻址方式**
**(3)操作数在寄存器中为<u>寄存器</u>寻址方式**
**(4)操作数地址在寄存器中为<u>寄存器间接</u>寻址方式**

**5.5 某计算机字长为16位，运算器为16位，有16个通用寄存器，8种寻址方式，主存为128KW,指令中操作数地址码由寻址方式字段和寄存器号字段组成。请回答下列问题。**
**(1)单操作数指令最多有多少条?**
**(2)双操作数指令最多有多少条?**
**~~(3)直接寻址的范围多大?~~**
**(4)变址寻址的范围多大?**

(1) 16个通用寄存器所以需要4位，8种寻址方式需要3位，所以操作数地址码占7位，单操作数指令剩下9位用于指令，所以最多有512条单操作数指令
(2) 存在两个操作数寻址，所以剩下2位，所以最多有4条双操作数指令
(4) 寄存器为16位，所以编址寻址地址范围为0000H-FFFFH

**5.7设相对寻址的转移指令占3个字节，第一个字节是操作码，第二个字节是相对位移量(补码表示)的低8位，第三个字节是相对位移量（补码表示)的高8位，每当CPU从存储器取一个字节时，便自动完成(PC)+1-PC。请回答下列问题。**
**(1)若PC当前值为256(十进制)，要求转移到290(十进制)，则转移指令第二、三字节的机器代码是什么(十六进制)?**
**(2)若PC当前值为128(十进制)，要求转移到110(十进制)，则转移指令第二、三字节的机器代码又是什么(十六进制)?**

(1)一个转移指令占3个字节，所以运行完跳转指令后PC=259，因此跳转的字节数位31，转化为十六进制为1F，因此转移指令的第二字节为1F，第三字节为00

(2)同理运行完跳转指令后PC=131，要跳转到110需要跳转-21个字节，进行符号扩展并转换为十六进制为FFEB，因此转移跳转指令的第二字节为EB，第三字节为FF

**5.11假定以下C语言语句中包含的变量f、g、h、i、j分别存放在寄存器\$11～$15中，写出实现C语言语句`f=(g+h)*i/j`功能的MIPS汇编指令序列，并写出每条MIPS指令的十六进制数。**

所用的指令都是R型指令，对应的指令的格式如下图所示：

![image-20230510214748220](C:\Users\26401\AppData\Roaming\Typora\typora-user-images\image-20230510214748220.png)

| 汇编语句            | 操作码机器码 | 指令机器码 |
| ------------------- | ------------ | ---------- |
| add   \$t3,\$t4,$t5 | 32           | 018D5820H  |
| mult \$t3,\$t6      | 24           | 016E0018H  |
| mflo $t3            | 17           | 00005812H  |
| div   \$t3,\$t7     | 26           | 016F001AH  |
| mflo $t3            | 17           | 00005812H  |

**5.12某计算机字长为16位，主存地址空间大小为128KB，按字编址。采用单字长指令格式，指令各字段定义如图5.34所示。**

![image-20230506222124979](C:\Users\26401\AppData\Roaming\Typora\typora-user-images\image-20230506222124979.png)

**转移指令采用相对寻址方式，相对偏移量用补码表示，寻址方式定义如表5.20所示。**

**![image-20230506222147992](C:\Users\26401\AppData\Roaming\Typora\typora-user-images\image-20230506222147992.png)**

**(1)该指令系统最多可有多少条指令?该计算机最多有多少个通用寄存器?
(2)存储器地址寄存器MAR和存储器数据寄存器MDR至少各需要多少位?
(3)转移指令的目标地址范围是多少?**
**(4)若操作码0010B表示加法操作（助记符为add )，寄存器R4和R5的编号分别为100B和101B，R4的内容为1234H，R5的内容为5678H，地址 1234H中的内容为5678H，地址5678H中的内容为1234H,则汇编语言为“add (R4)(R5)+”(逗号前为源操作数,逗号后为目的操作数)对应的机器码是什么(用十六进制表示)﹖该指令执行后，哪些寄存器和存储单元中的内容会改变?改变后的内容是什么?**

(1)OP一共有4位，所以最多总共有16条不同的指令；Rs占3位，所以最多有8个通用寄存器
(2)主存大小为128KB，按照字编址，一个字为两个字节，因此寻址空间为0000H-FFFFH，因此存储器地址寄存器MAR至少需要16位，机器字长为16位，所以存储器数据寄存器MDR至少需要16位
(3)考虑相对寻址，因为PC为16位，所以地址范围为0000H-FFFFH
(4)对应机器码为0010 001 100 010 101，十六进制为2315H
执行R5从5678H变成5679H，存储单元5678H里的内容变成68ACH

**5.13某计算机采用16位定长指令字格式，其CPU中有一个标志寄存器，其中包含进位/借位标志CF、零标志ZF和符号标志NF。假定为该计算机设计了条件转移指令，其格式如图5.35所示。**

**![image-20230506222627401](C:\Users\26401\AppData\Roaming\Typora\typora-user-images\image-20230506222627401.png)**

**其中，00000为操作码OP;C、Z和N分别为CF、ZF和NF的对应检测位，某检测位为1时表示需检测对应标志，需检测的标志位中只要有一个为1就转移，否则不转移。例如，若C=1，Z=0，N=1，则需检测CF和NF的值，当CF=1或NF=1时发生转移;OFFSET是相对偏移量，用补码表示。转移执行时，转移目标地址为(PC)+2+OFFSET×2;顺序执行时，下条指令地址为(PC)+2。请回答下列问题。**

**(1)该计算机存储器按字节编址还是按字编址?该条件转移指令向后(反向)最多可跳转多少条指令?**
**(2)某条件转移指令的地址为200CH，指令内容如图5.36所示，若该指令执行时CF=0，ZF=0,NF=1，则该指令执行后PC的值是多少?若该指令执行时CF=1，ZF=0，NF=0，则该指令执行后PC的值又是多少?请给出计算过程。**

**![image-20230506222638796](C:\Users\26401\AppData\Roaming\Typora\typora-user-images\image-20230506222638796.png)**

**(3）实现“无符号数比较小于等于时转移”功能的指令中，C、Z和N应各是什么?**

(1)顺序执行时下一条指令地址为(PC)+2，因此可以知道一条指令占两个存储单元，一条指令为16位，所以可以知道一个存储单元内为8位，所以是按照字节编址；偏移占8位，使用补码表示，所以范围为-128-127，跳转时需要将偏移量乘2，同时因为跳转时PC会先加1，所以计算可知反向最多可以跳转127条指令
(2)发生跳转，偏移量为E3H，符号扩展再左移一位得到FFC6H，所以此时PC为200CH+2+FFC6H=1FD4H；不发生跳转，所以（PC）=200EH
(3)C=Z=1.N=0